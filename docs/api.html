<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - Kollect</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/style.css" rel="stylesheet">
    <style>
        .doc-content { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }
        .doc-nav { background: var(--bg-light); padding: 1rem 0; border-bottom: 1px solid var(--border-color); }
        .breadcrumb { display: flex; align-items: center; gap: 0.5rem; color: var(--text-light); }
        .breadcrumb a { color: var(--primary-color); text-decoration: none; }
        .code-block { background: var(--bg-light); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1.5rem; margin: 1rem 0; overflow-x: auto; }
        .endpoint { background: white; border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1.5rem; margin: 1rem 0; }
        .method { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: bold; font-size: 0.875rem; }
        .method.get { background: #e7f3ff; color: #0066cc; }
        .method.post { background: #e7f9e7; color: #008800; }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <i class="fas fa-search-plus"></i>
                    <span>Kollect</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="getting-started.html">Docs</a></li>
                    <li><a href="https://github.com/MichaelCade/kollect" target="_blank">GitHub</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="doc-nav">
        <div class="container">
            <div class="breadcrumb">
                <a href="../index.html">Home</a>
                <i class="fas fa-chevron-right"></i>
                <a href="getting-started.html">Documentation</a>
                <i class="fas fa-chevron-right"></i>
                <span>API Reference</span>
            </div>
        </div>
    </div>

    <main class="doc-content">
        <h1>API Reference</h1>
        
        <p>Kollect provides a REST API for accessing inventory data and managing platform connections. The API runs on <strong>http://localhost:8080</strong> when kollect is running.</p>
        
        <h2>Base URL</h2>
        <div class="code-block">
            <pre><code>http://localhost:8080/api</code></pre>
        </div>

        <h2>Authentication</h2>
        <p>The API does not require authentication when accessing the local instance.</p>

        <h2>Core Data Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/data</h3>
            <p>Retrieve all discovered infrastructure data across all platforms. This is the main endpoint that returns the complete inventory.</p>
            
            <h4>Response Structure</h4>
            <div class="code-block">
                <pre><code>{
  "aws": {
    "EC2Instances": [...],
    "S3Buckets": [...],
    "RDSInstances": [...],
    "DynamoDBTables": [...],
    "VPCs": [...],
    "EFSFileSystems": [...]
  },
  "azure": {
    "VirtualMachines": [...],
    "StorageAccounts": [...],
    "BlobContainers": [...],
    "VirtualNetworks": [...],
    "ResourceGroups": [...]
  },
  "gcp": {
    "ComputeInstances": [...],
    "GCSBuckets": [...],
    "CloudSQLInstances": [...]
  },
  "kubernetes": {
    "Namespaces": [...],
    "Pods": [...],
    "Services": [...],
    "Deployments": [...]
  },
  "docker": {
    "containers": [...],
    "images": [...],
    "volumes": [...],
    "networks": [...]
  },
  "terraform": {
    "Resources": [...],
    "Outputs": [...],
    "Variables": [...]
  },
  "vault": {
    "Secrets": [...],
    "Policies": [...],
    "AuthMethods": [...]
  },
  "vsphere": {
    "VirtualMachines": [...],
    "Clusters": [...],
    "Hosts": [...],
    "Datastores": [...]
  }
}</code></pre>
            </div>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/import</h3>
            <p>Import data from a JSON file or external source into kollect.</p>
            
            <h4>Request Body</h4>
            <div class="code-block">
                <pre><code>{
  "aws": { ... },
  "azure": { ... },
  "gcp": { ... }
}</code></pre>
            </div>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/switch</h3>
            <p>Switch between different inventory datasets or sources.</p>
        </div>

        <h2>Snapshot Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/snapshots</h3>
            <p>Retrieve snapshot information across all platforms. Used by the Snapshot Hunter feature.</p>
            
            <h4>Response</h4>
            <div class="code-block">
                <pre><code>{
  "aws": {
    "EBSSnapshots": [...],
    "RDSSnapshots": [...]
  },
  "azure": {
    "DiskSnapshots": [...],
    "VMSnapshots": [...]
  },
  "gcp": {
    "DiskSnapshots": [...],
    "PersistentDiskSnapshots": [...]
  }
}</code></pre>
            </div>
        </div>

        <h2>Cost Analysis Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/costs</h3>
            <p>Retrieve cost analysis data across cloud platforms. Used by the Cost Explorer feature.</p>
            
            <h4>Query Parameters</h4>
            <ul>
                <li><code>platform</code> - Filter by cloud platform (aws, azure, gcp)</li>
                <li><code>timeframe</code> - Time period for cost analysis</li>
            </ul>
        </div>

        <h2>Platform Connection Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/check-credentials</h3>
            <p>Check the connection status of all configured platforms. Used by the web interface to show connection badges.</p>
            
            <h4>Response</h4>
            <div class="code-block">
                <pre><code>{
  "aws": true,
  "azure": false,
  "gcp": true,
  "kubernetes": true,
  "docker": true,
  "terraform": false,
  "vault": false,
  "vsphere": false,
  "veeam": false
}</code></pre>
            </div>
        </div>

        <h2>Platform-Specific Connection Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/aws/connect</h3>
            <p>Connect to AWS and trigger resource discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/azure/connect</h3>
            <p>Connect to Azure and trigger resource discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/azure/subscriptions</h3>
            <p>List available Azure subscriptions.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/gcp/connect</h3>
            <p>Connect to Google Cloud and trigger resource discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/gcp/projects</h3>
            <p>List available GCP projects.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/kubernetes/connect</h3>
            <p>Connect to Kubernetes cluster and trigger resource discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/kubernetes/contexts</h3>
            <p>List available Kubernetes contexts from kubeconfig.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/kubernetes/upload-kubeconfig</h3>
            <p>Upload a kubeconfig file for Kubernetes connection.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/docker/connect</h3>
            <p>Connect to Docker daemon and trigger container discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/docker/test-connection</h3>
            <p>Test Docker daemon connectivity.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/terraform/connect</h3>
            <p>Connect to Terraform state and trigger resource discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/terraform/upload-state</h3>
            <p>Upload a Terraform state file for analysis.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/vault/connect</h3>
            <p>Connect to HashiCorp Vault and trigger secret discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/vsphere/connect</h3>
            <p>Connect to VMware vSphere and trigger VM discovery.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/vsphere</h3>
            <p>Get vSphere connection status and basic information.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/veeam/connect</h3>
            <p>Connect to Veeam Backup & Replication server.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/rubrik/connect</h3>
            <p>Connect to Rubrik backup platform.</p>
        </div>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/cohesity/connect</h3>
            <p>Connect to Cohesity backup platform.</p>
        </div>
            <p>Get detailed status information for all discovery providers.</p>
            
            <h4>Response</h4>
            <div class="code-block">
                <pre><code>{
  "providers": {
    "aws": {
      "status": "connected",
      "last_scan": "2025-10-29T10:30:00Z",
      "resources_found": 45,
      "errors": []
    },
    "azure": {
      "status": "error",
      "last_scan": "2025-10-29T09:15:00Z",
      "resources_found": 0,
      "errors": ["Authentication failed"]
    }
  }
}</code></pre>
            </div>
        </div>

        <h2>Discovery Control Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method post">POST</span> /api/discover</h3>
            <p>Trigger a new discovery scan.</p>
            
            <h4>Request Body</h4>
            <div class="code-block">
                <pre><code>{
  "providers": ["aws", "azure"],
  "force_refresh": true
}</code></pre>
            </div>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/discover/status</h3>
            <p>Get the status of the current discovery operation.</p>
            
            <h4>Response</h4>
            <div class="code-block">
                <pre><code>{
  "status": "running",
  "progress": 65,
  "current_provider": "aws",
  "started_at": "2025-10-29T10:30:00Z",
  "estimated_completion": "2025-10-29T10:35:00Z"
}</code></pre>
            </div>
        </div>

        <h2>Export Endpoints</h2>

                <h2>Error Responses</h2>

        <p>All endpoints return appropriate HTTP status codes. Error responses are in JSON format:</p>

        <div class="code-block">
            <pre><code>{
  "error": "Connection failed",
  "details": "Unable to connect to AWS: invalid credentials"
}</code></pre>
        </div>

        <h3>Common Status Codes</h3>
        <ul>
            <li><code>200</code> - Success: Request completed successfully</li>
            <li><code>400</code> - Bad Request: Invalid request parameters</li>
            <li><code>500</code> - Internal Server Error: Platform connection or discovery error</li>
        </ul>

        <h2>Usage Examples</h2>

        <h3>Using cURL</h3>
        <div class="code-block">
            <pre><code># Get all discovered data
curl http://localhost:8080/api/data

# Check platform connections
curl http://localhost:8080/api/check-credentials

# Get snapshots
curl http://localhost:8080/api/snapshots

# Get cost analysis
curl http://localhost:8080/api/costs

# Import data from file
curl -X POST http://localhost:8080/api/import \
  -H "Content-Type: application/json" \
  -d @my-infrastructure-data.json</code></pre>
        </div>

        <h3>Using JavaScript/Fetch</h3>
        <div class="code-block">
            <pre><code>// Get all data
fetch('http://localhost:8080/api/data')
  .then(response => response.json())
  .then(data => console.log(data));

// Check credentials
fetch('http://localhost:8080/api/check-credentials')
  .then(response => response.json())
  .then(status => {
    if (status.aws) {
      console.log('AWS is connected');
    }
  });

// Import data
fetch('http://localhost:8080/api/import', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(importData)
});</code></pre>
        </div>

        <h2>Integration Notes</h2>

        <div class="info">
            <h4>🔧 Development Tips</h4>
            <ul>
                <li>The API is designed for local development and testing</li>
                <li>Data is held in memory while kollect is running</li>
                <li>Use <code>--output</code> flag to persist data to files</li>
                <li>Platform connections are tested in real-time</li>
                <li>CORS is enabled for local development</li>
            </ul>
        </div>

        <h2>Error Responses</h2>

        <p>All endpoints return standard HTTP status codes and JSON error responses:</p>

        <div class="code-block">
            <pre><code>{
  "error": "Authentication failed",
  "code": "AUTH_ERROR",
  "timestamp": "2025-10-29T10:30:00Z",
  "details": {
    "provider": "aws",
    "region": "us-east-1"
  }
}</code></pre>
        </div>

        <h3>Common Error Codes</h3>
        <ul>
            <li><code>400</code> - Bad Request: Invalid request parameters</li>
            <li><code>401</code> - Unauthorized: Authentication required</li>
            <li><code>403</code> - Forbidden: Insufficient permissions</li>
            <li><code>404</code> - Not Found: Resource not found</li>
            <li><code>429</code> - Too Many Requests: Rate limit exceeded</li>
            <li><code>500</code> - Internal Server Error: Server error</li>
            <li><code>503</code> - Service Unavailable: Service temporarily unavailable</li>
        </ul>

        <h2>Usage Examples</h2>

        <h3>cURL Examples</h3>
        <div class="code-block">
            <pre><code># Get all data
curl http://localhost:8080/api/data

# Get AWS data only
curl http://localhost:8080/api/data/aws

# Get cost data for AWS
curl "http://localhost:8080/api/costs?platform=aws&timeframe=30d"

# Trigger discovery
curl -X POST http://localhost:8080/api/discover \
  -H "Content-Type: application/json" \
  -d '{"providers": ["aws", "azure"]}'

# Export to CSV
curl "http://localhost:8080/api/export?format=csv" -o infrastructure.csv</code></pre>
        </div>

        <h3>Python Example</h3>
        <div class="code-block">
            <pre><code>import requests
import json

# Get all infrastructure data
response = requests.get('http://localhost:8080/api/data')
data = response.json()

# Print AWS EC2 instances
for instance in data.get('aws', {}).get('EC2Instances', []):
    print(f"{instance['Name']} ({instance['Type']}) - {instance['State']}")

# Trigger new discovery
discovery_request = {
    "providers": ["aws", "azure"],
    "force_refresh": True
}
response = requests.post(
    'http://localhost:8080/api/discover',
    headers={'Content-Type': 'application/json'},
    data=json.dumps(discovery_request)
)</code></pre>
        </div>

        <h2>Rate Limiting</h2>

        <p>The API implements rate limiting to prevent abuse:</p>
        <ul>
            <li>Data endpoints: 100 requests per minute</li>
            <li>Discovery endpoints: 10 requests per minute</li>
            <li>Export endpoints: 5 requests per minute</li>
        </ul>

        <p>Rate limit headers are included in responses:</p>
        <div class="code-block">
            <pre><code>X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1635520800</code></pre>
        </div>

        <h2>Webhooks</h2>

        <p>Configure webhooks to receive notifications when discovery completes:</p>

        <div class="code-block">
            <pre><code># In configuration file
webhooks:
  discovery_complete:
    url: "https://your-webhook-endpoint.com/kollect"
    headers:
      Authorization: "Bearer your-token"</code></pre>
        </div>

        <p>For more API examples and integration patterns, visit our <a href="https://github.com/MichaelCade/kollect/tree/main/examples" target="_blank">GitHub examples</a>.</p>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <i class="fas fa-search-plus"></i>
                    <span>Kollect</span>
                </div>
                <div class="footer-links">
                    <a href="https://github.com/MichaelCade/kollect">GitHub</a>
                    <a href="../index.html">Home</a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>