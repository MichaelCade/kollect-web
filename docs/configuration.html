<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration - Kollect</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/style.css" rel="stylesheet">
    <style>
        .doc-content { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }
        .doc-nav { background: var(--bg-light); padding: 1rem 0; border-bottom: 1px solid var(--border-color); }
        .breadcrumb { display: flex; align-items: center; gap: 0.5rem; color: var(--text-light); }
        .breadcrumb a { color: var(--primary-color); text-decoration: none; }
        .code-block { background: var(--bg-light); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1.5rem; margin: 1rem 0; overflow-x: auto; }
        .warning { background: #fef3cd; border: 1px solid #fecb6b; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; }
        .info { background: #cff4fc; border: 1px solid #9eeaf9; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <i class="fas fa-search-plus"></i>
                    <span>Kollect</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="getting-started.html">Docs</a></li>
                    <li><a href="https://github.com/MichaelCade/kollect" target="_blank">GitHub</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="doc-nav">
        <div class="container">
            <div class="breadcrumb">
                <a href="../index.html">Home</a>
                <i class="fas fa-chevron-right"></i>
                <a href="getting-started.html">Documentation</a>
                <i class="fas fa-chevron-right"></i>
                <span>Configuration</span>
            </div>
        </div>
    </div>

    <main class="doc-content">
        <h1>Configuration Guide</h1>
        
        <p>Kollect can be configured through environment variables, command-line flags, or configuration files to customize discovery behavior and authentication.</p>

        <h2>Configuration File</h2>

        <p>Create a configuration file to define discovery settings and credentials:</p>

        <div class="code-block">
            <pre><code># kollect.yaml
server:
  port: 8080
  host: "0.0.0.0"

discovery:
  enabled_providers:
    - aws
    - azure
    - gcp
    - vsphere
    - docker
    - kubernetes
  
  concurrent_scans: 5
  timeout: 300s

aws:
  regions:
    - us-east-1
    - us-west-2
    - eu-west-1
  services:
    - ec2
    - s3
    - rds
    - dynamodb

azure:
  subscription_ids:
    - "your-subscription-id"
  resource_groups: []  # empty = all
  
gcp:
  project_ids:
    - "your-project-id"
  regions:
    - us-central1
    - europe-west1

vsphere:
  vcenter_host: "vcenter.example.com"
  username: "readonly-user"
  password: "password"
  insecure: false

docker:
  socket: "unix:///var/run/docker.sock"
  
kubernetes:
  kubeconfig: "~/.kube/config"
  contexts: []  # empty = all contexts</code></pre>
        </div>

        <p>Use the configuration file:</p>
        <div class="code-block">
            <pre><code>./kollect -config kollect.yaml</code></pre>
        </div>

        <h2>Environment Variables</h2>

        <h3>Server Configuration</h3>
        <div class="code-block">
            <pre><code># Server settings
export KOLLECT_PORT=8080
export KOLLECT_HOST="0.0.0.0"
export KOLLECT_LOG_LEVEL="info"</code></pre>
        </div>

        <h3>AWS Configuration</h3>
        <div class="code-block">
            <pre><code># AWS Credentials
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_DEFAULT_REGION="us-east-1"
export AWS_SESSION_TOKEN="session-token"  # for temporary credentials

# Kollect-specific AWS settings
export KOLLECT_AWS_REGIONS="us-east-1,us-west-2,eu-west-1"
export KOLLECT_AWS_PROFILE="default"</code></pre>
        </div>

        <h3>Azure Configuration</h3>
        <div class="code-block">
            <pre><code># Azure Credentials
export AZURE_CLIENT_ID="your-client-id"
export AZURE_CLIENT_SECRET="your-client-secret"
export AZURE_TENANT_ID="your-tenant-id"
export AZURE_SUBSCRIPTION_ID="your-subscription-id"

# Kollect-specific Azure settings
export KOLLECT_AZURE_RESOURCE_GROUPS="rg1,rg2"  # empty = all</code></pre>
        </div>

        <h3>Google Cloud Configuration</h3>
        <div class="code-block">
            <pre><code># GCP Credentials
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"
export GOOGLE_CLOUD_PROJECT="your-project-id"

# Kollect-specific GCP settings
export KOLLECT_GCP_PROJECTS="project1,project2"
export KOLLECT_GCP_REGIONS="us-central1,europe-west1"</code></pre>
        </div>

        <h3>VMware vSphere Configuration</h3>
        <div class="code-block">
            <pre><code># vSphere Connection
export VSPHERE_SERVER="vcenter.example.com"
export VSPHERE_USER="readonly-user"
export VSPHERE_PASSWORD="password"
export VSPHERE_INSECURE="false"  # skip SSL verification</code></pre>
        </div>

        <h2>Command Line Flags</h2>

        <div class="code-block">
            <pre><code>./kollect [flags]

Server Options:
  -port int         Port for web server (default 8080)
  -host string      Host to bind to (default "localhost")
  -config string    Path to configuration file

Discovery Options:
  -providers string    Comma-separated list of providers (aws,azure,gcp,vsphere,docker,k8s)
  -output string       Output format: web, json, csv (default "web")
  -concurrent int      Number of concurrent scans (default 5)
  -timeout duration    Scan timeout (default 5m)

AWS Options:
  -aws-regions string    Comma-separated AWS regions
  -aws-profile string    AWS profile to use

Azure Options:
  -azure-subscription string  Azure subscription ID
  -azure-resource-groups string  Comma-separated resource groups

Other Options:
  -verbose       Enable verbose logging
  -help          Show help
  -version       Show version</code></pre>
        </div>

        <h2>Authentication Methods</h2>

        <h3>AWS Authentication Priority</h3>
        <ol>
            <li>Environment variables</li>
            <li>AWS credentials file (~/.aws/credentials)</li>
            <li>AWS config file (~/.aws/config)</li>
            <li>IAM roles for EC2 instances</li>
            <li>IAM roles for ECS tasks</li>
        </ol>

        <h3>Azure Authentication Priority</h3>
        <ol>
            <li>Environment variables</li>
            <li>Managed Identity (when running on Azure)</li>
            <li>Azure CLI credentials</li>
            <li>Azure PowerShell credentials</li>
        </ol>

        <h3>Google Cloud Authentication Priority</h3>
        <ol>
            <li>Service account key file (GOOGLE_APPLICATION_CREDENTIALS)</li>
            <li>gcloud user credentials</li>
            <li>Google Cloud metadata service (when running on GCP)</li>
        </ol>

        <h2>Security Best Practices</h2>

        <div class="warning">
            <h4>Important Security Considerations</h4>
            <ul>
                <li>Use read-only credentials whenever possible</li>
                <li>Implement least-privilege access policies</li>
                <li>Rotate credentials regularly</li>
                <li>Avoid storing credentials in configuration files</li>
                <li>Use temporary credentials when available</li>
            </ul>
        </div>

        <h3>AWS IAM Policy Example</h3>
        <div class="code-block">
            <pre><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:Describe*",
        "s3:ListAllMyBuckets",
        "s3:ListBucket",
        "rds:Describe*",
        "dynamodb:ListTables",
        "dynamodb:DescribeTable",
        "efs:Describe*",
        "vpc:Describe*"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
        </div>

        <h3>Azure Role Assignment Example</h3>
        <div class="code-block">
            <pre><code># Assign Reader role to service principal
az role assignment create \
  --assignee "your-service-principal-id" \
  --role "Reader" \
  --scope "/subscriptions/your-subscription-id"</code></pre>
        </div>

        <h2>Filtering and Customization</h2>

        <h3>Resource Filtering</h3>
        <p>Configure which resources to discover:</p>

        <div class="code-block">
            <pre><code># Environment variables for filtering
export KOLLECT_AWS_SERVICES="ec2,s3,rds"
export KOLLECT_AZURE_RESOURCE_TYPES="virtualMachines,storageAccounts"
export KOLLECT_SKIP_STOPPED_INSTANCES="true"</code></pre>
        </div>

        <h3>Custom Tags and Labels</h3>
        <p>Filter resources based on tags:</p>

        <div class="code-block">
            <pre><code># In configuration file
filters:
  aws:
    required_tags:
      Environment: ["prod", "staging"]
      Team: ["platform", "devops"]
  
  azure:
    required_tags:
      Project: ["web-app", "api"]</code></pre>
        </div>

        <h2>Performance Tuning</h2>

        <h3>Concurrent Scanning</h3>
        <div class="code-block">
            <pre><code># Increase concurrent scans for faster discovery
export KOLLECT_CONCURRENT_SCANS=10
export KOLLECT_TIMEOUT=600s</code></pre>
        </div>

        <h3>Caching</h3>
        <div class="code-block">
            <pre><code># Enable result caching
export KOLLECT_CACHE_ENABLED="true"
export KOLLECT_CACHE_TTL="300s"</code></pre>
        </div>

        <div class="info">
            <p><strong>Tip:</strong> Start with conservative settings and gradually increase concurrency based on your infrastructure size and API rate limits.</p>
        </div>

        <h2>Troubleshooting Configuration</h2>

        <h3>Verify Configuration</h3>
        <div class="code-block">
            <pre><code># Test configuration without running full discovery
./kollect -config kollect.yaml -dry-run

# Enable verbose logging
./kollect -verbose</code></pre>
        </div>

        <h3>Common Issues</h3>
        <ul>
            <li><strong>Authentication failures</strong>: Check credential configuration and permissions</li>
            <li><strong>Network timeouts</strong>: Increase timeout values and check connectivity</li>
            <li><strong>Rate limiting</strong>: Reduce concurrent scans or implement backoff</li>
            <li><strong>Missing resources</strong>: Verify region/project configuration</li>
        </ul>

        <p>For more troubleshooting help, see the <a href="troubleshooting.html">troubleshooting guide</a>.</p>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <i class="fas fa-search-plus"></i>
                    <span>Kollect</span>
                </div>
                <div class="footer-links">
                    <a href="https://github.com/MichaelCade/kollect">GitHub</a>
                    <a href="../index.html">Home</a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>